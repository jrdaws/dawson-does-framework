# Task: Expand Integration Test Coverage

Priority: P2
Assigned To: Testing Agent
Depends On: None
Estimated Effort: Medium

## Context
Template Agent's quality audit showed only saas template has bundled integrations.
Current integration tests only validate individual integrations, not combinations.
We need test coverage for all integration combinations to catch regressions.

The saas template currently has these integrations:
- auth (Supabase, Clerk)
- db (Supabase, PlanetScale)
- payments (Stripe, Paddle)
- email (Resend, SendGrid)
- analytics (Plausible, PostHog)
- ai (OpenAI, Anthropic)
- storage (UploadThing)

## Objectives
1. Add tests for common combination patterns:
   - auth + db + payments (most common SaaS stack)
   - auth + db + email (basic app with notifications)
   - auth + db + analytics (analytics-focused app)
2. Test that integration merging doesn't break builds
3. Verify integration metadata is valid (integration.json)
4. Test missing env var warnings work correctly

## Success Criteria
- [ ] Test coverage for 5 most common integration combinations
- [ ] Tests verify build succeeds after applying integrations
- [ ] Test time stays under 30s for full integration suite
- [ ] CI workflow includes integration combination tests
- [ ] At least 20 new integration tests added

## Files to Create
- tests/integration/integration-combinations.test.mjs (new)
- tests/integration/integration-build.test.mjs (new)

## Files to Reference
- templates/saas/integrations/**/integration.json
- src/dd/integrations.mjs (integration loader logic)

## Test Scenarios to Cover
1. Apply auth + db + payments → verify build succeeds
2. Apply incompatible combinations → verify error message
3. Apply integration with missing env vars → verify warning
4. Apply multiple integrations of same type → verify last wins
5. Integration metadata validation → verify all integration.json valid

## Handoff
1. Move task to done/
2. Write completion report with coverage metrics (before/after test count)
3. Update memory file
4. Note any integration bugs discovered during testing
