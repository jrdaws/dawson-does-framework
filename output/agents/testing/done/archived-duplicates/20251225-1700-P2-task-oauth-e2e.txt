# Task: Test Supabase OAuth E2E

Priority: P2
Assigned To: Testing Agent
Depends On: T0 (Commit Work), T2 (Connected Services UI - optional)
Estimated Effort: Medium (1 hour)
Cycle: 14 (Curated)
Quality Score: 8.0/10

---

## Context

Supabase OAuth integration was completed in Cycle 10 (Platform Agent). The backend routes exist but the full end-to-end flow needs validation with Playwright tests.

**Note**: This can be done in parallel with accordion tests or after T2 (Connected Services UI) is complete for full flow testing.

---

## Objectives

1. Create E2E test for Supabase OAuth flow
2. Test connect flow (redirect, callback, token storage)
3. Test disconnect flow (API call, UI update)
4. Document any issues found

---

## Success Criteria

- [ ] Playwright test for OAuth flow created
- [ ] Connect flow redirects to Supabase correctly
- [ ] Callback processes token and updates UI
- [ ] Disconnect removes connection from database
- [ ] Test passes or issues documented

---

## Files to Create

- `website/tests/supabase-oauth.spec.ts` (new)

---

## API Routes (Already Exist)

```
GET  /api/auth/connected-services  → List connected accounts
POST /api/auth/connect/[provider]  → Initiate OAuth flow
DELETE /api/auth/disconnect/[provider] → Remove connection
```

---

## Test Cases to Add

1. **Connected Services List**
   - API returns list of available providers
   - Shows "not connected" state initially

2. **Connect Flow Initiation**
   - Click "Connect GitHub" → redirects to OAuth provider
   - Mock/intercept OAuth response for testing

3. **Callback Processing**
   - OAuth callback URL processes token
   - User returned to app with success state

4. **Disconnect Flow**
   - Click "Disconnect" → API call succeeds
   - UI updates to "not connected" state

5. **Error Handling**
   - Invalid callback → graceful error message
   - Network failure → retry guidance shown

---

## Commands

```bash
cd /Users/joseph.dawson/Documents/dawson-does-framework/website

# Run OAuth tests specifically
npx playwright test supabase-oauth.spec.ts --project=chromium

# Note: May need env vars for real OAuth testing
# SUPABASE_URL, SUPABASE_ANON_KEY
```

---

## Handoff

1. Move task to `output/agents/testing/done/`
2. Report test results to `output/agents/testing/outbox/`
3. Flag any OAuth issues to Platform Agent for fixes
4. Update TESTING_MEMORY.md

---

(Task curated by CURATOR Agent - Cycle 14)

