# Task: User Feedback Collection Endpoint

**Priority:** P2 (Medium)
**Assigned To:** Website Agent
**Created:** 2025-12-23 06:30
**Quality Score:** 8.0/10
**Depends On:** Production deployment (can be developed in parallel)

---

## Context

With Phase 1 complete, we need structured user feedback to guide Phase 2 development. This endpoint will collect quality ratings and comments on generated projects to validate generation quality and UX decisions.

## Vision Alignment

- **Export-First**: Feedback helps improve export quality
- **Developer-Centric**: Collect actionable developer feedback
- **Transparency**: Users see their feedback is valued

## Task Objectives

### 1. Create Feedback API Endpoint

**POST /api/feedback**

Request schema:
```typescript
interface FeedbackRequest {
  projectId?: string;          // If feedback on specific generation
  rating: 1 | 2 | 3 | 4 | 5;   // Star rating
  category: 'quality' | 'speed' | 'accuracy' | 'ux' | 'other';
  comment?: string;            // Optional detailed feedback (max 1000 chars)
  tier?: 'fast' | 'balanced' | 'quality';  // Which tier was used
  template?: string;           // Which template was selected
}
```

Response schema (following API_CONTRACTS.md):
```typescript
// Success
{ success: true, data: { id: string, message: string } }

// Error
{ success: false, error: { code: string, message: string } }
```

### 2. Database Schema

Create Supabase migration:
```sql
CREATE TABLE feedback (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  project_id UUID REFERENCES projects(id),
  rating INTEGER NOT NULL CHECK (rating >= 1 AND rating <= 5),
  category TEXT NOT NULL,
  comment TEXT,
  tier TEXT,
  template TEXT,
  ip_hash TEXT,  -- Hashed for rate limiting, not stored raw
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_feedback_created ON feedback(created_at DESC);
CREATE INDEX idx_feedback_rating ON feedback(rating);
```

### 3. Rate Limiting

Implement rate limiting:
- 5 submissions per IP per hour
- Use existing rate limiting pattern if available
- Return 429 with retry-after header when exceeded

### 4. Feedback Form Component (Optional)

Create `website/app/components/configurator/FeedbackForm.tsx`:
- Simple star rating UI
- Category dropdown
- Optional comment textarea
- Submit button with loading state

## Success Criteria

- [ ] POST /api/feedback endpoint works
- [ ] Feedback stored in Supabase with timestamps
- [ ] Rate limited (5/hour per IP)
- [ ] Input validation with helpful error messages
- [ ] Uses apiError/apiSuccess helpers from API_CONTRACTS.md

## Files to Create/Modify

- `website/app/api/feedback/route.ts` (create)
- `website/lib/supabase/feedback.ts` (create - db helper)
- `website/app/components/configurator/FeedbackForm.tsx` (create - optional)

## Reference

- `docs/standards/API_CONTRACTS.md` - Response format
- `website/lib/api-errors.ts` - apiError/apiSuccess helpers
- Existing rate limiting patterns in website/

## Handoff

When complete:
1. Move this file to `output/website-agent/done/`
2. Create completion report in `output/website-agent/outbox/`
3. Provide SQL migration script
4. Commit: `feat(website): add user feedback collection endpoint`

---

*Read and execute this task. Follow governance in AGENT_CONTEXT.md.*


