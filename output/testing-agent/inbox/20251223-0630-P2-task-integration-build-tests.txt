# Task: Integration Build Testing

**Priority:** P2 (Medium)
**Assigned To:** Testing Agent
**Created:** 2025-12-23 06:30
**Quality Score:** 7.8/10
**Complements:** 20251223-0600-P2-task-integration-unit-tests.txt

---

## Context

Template Agent's quality audit showed the saas template has 9 integrations across 6 categories. We need to verify that integration combinations work correctly when applied and that the resulting projects build successfully.

This task **complements** the existing unit test task which focuses on `src/dd/integrations.mjs` functions. This task focuses on end-to-end integration verification.

## Vision Alignment

- **Export-First**: Integrations must work in exported projects
- **Zero Lock-In**: Verify integrations don't create hidden dependencies
- **Fail Gracefully**: Test error handling for missing env vars

## Task Objectives

### 1. Integration Combination Tests

Create `tests/integration/integration-combinations.test.mjs`:

```javascript
import { describe, test } from 'node:test'
import assert from 'node:assert'
import { exportTemplate } from '../../src/dd/export.mjs'
import { applyIntegration } from '../../src/dd/integrations.mjs'

describe('Integration Combinations', () => {
  // Common SaaS stack
  test('saas + supabase auth + supabase db + stripe', async () => {
    // Export with integrations, verify no conflicts
  })
  
  // Auth providers
  test('saas + clerk auth + supabase db', async () => {
    // Verify different auth provider works
  })
  
  // Analytics + Email combo
  test('saas + posthog + resend', async () => {
    // Verify analytics and email don't conflict
  })
})
```

### 2. Build Verification Tests

Create `tests/integration/integration-build.test.mjs`:

```javascript
describe('Integration Build Verification', () => {
  test('exported project with integrations has valid package.json', async () => {
    // Export, verify dependencies are merged correctly
  })
  
  test('typescript compiles after integration apply', async () => {
    // Export, run tsc --noEmit, verify no errors
  })
  
  test('integration files are correctly copied', async () => {
    // Verify all files from integration.json exist in output
  })
})
```

### 3. Env Validation Tests

```javascript
describe('Integration Environment Handling', () => {
  test('missing env vars show warning not error', async () => {
    // Run integration code, verify graceful degradation
  })
  
  test('env.example includes all integration vars', async () => {
    // Verify .env.example has all required vars documented
  })
})
```

## Success Criteria

- [ ] 5+ combination tests for common patterns
- [ ] Build verification tests check package.json merging
- [ ] TypeScript compilation test for exported projects
- [ ] Test duration stays under 30 seconds
- [ ] All 680+ tests pass (includes new tests)

## Files to Create

- `tests/integration/integration-combinations.test.mjs`
- `tests/integration/integration-build.test.mjs`

## Reference

- `src/dd/integrations.mjs` - Integration loading functions
- `src/dd/export.mjs` - Export command implementation
- `templates/saas/integrations/` - Available integrations
- Existing test patterns in `tests/`

## Handoff

When complete:
1. Move this file to `output/testing-agent/done/`
2. Update test count in PROJECT_STATUS.md
3. Commit: `test(integrations): add combination and build verification tests`

---

*Read and execute this task. Follow governance in AGENT_CONTEXT.md.*


