ADVANCED TASK: Create Context Freshness Verification Rule
==========================================================

AGENT: Documentation Agent
PRIORITY: P1 - HIGH
DATE: 2025-12-23

OBJECTIVE:
----------
Design and implement a comprehensive "Context Freshness Verification" system that 
ensures agents always have current information before starting work from inbox prompts.

PROBLEM STATEMENT:
------------------
When agents read a .txt prompt file from their inbox to begin work, they may be
operating with outdated context if key governance files, SOPs, or project state
have changed since their last session. This leads to:

- Agents following outdated procedures
- Inconsistent outputs across agents
- Duplicated or conflicting work
- Violations of newly added rules

REQUIREMENTS:
-------------

### 1. Identify Key Files That Affect Agent Work

Create a tiered file classification:

**Tier 1 - Critical (Check EVERY session)**
- AGENT_CONTEXT.md
- CLAUDE.md / .cursorrules
- prompts/agents/AGENT_POLICIES.md
- output/shared/PROJECT_PRIORITIES.md

**Tier 2 - Role-Specific (Check if role matches)**
- prompts/agents/roles/[ROLE]_AGENT.md
- prompts/agents/memory/[ROLE]_MEMORY.md
- Role-specific SOPs

**Tier 3 - Reference (Check if task requires)**
- docs/sops/*.md
- docs/standards/*.md
- Template files

### 2. Determine Freshness Thresholds

| File Tier | Stale After | Re-read Required |
|-----------|-------------|------------------|
| Tier 1 | 2 hours | Always on inbox read |
| Tier 2 | 4 hours | If role matches |
| Tier 3 | 24 hours | If task references |

### 3. Create Verification Protocol

When an agent reads a prompt from their inbox, they MUST:

```
## Pre-Work Context Verification

Before executing this task, I verified:

1. **Governance Check** (Tier 1)
   - [ ] AGENT_POLICIES.md version: [current version]
   - [ ] Last read: [timestamp] - [Fresh/Stale]
   - [ ] PROJECT_PRIORITIES.md: [checked/needs check]

2. **Role Context Check** (Tier 2)
   - [ ] Role file version: [current]
   - [ ] Memory file last updated: [timestamp]
   - [ ] Any new sessions since my last read? [Y/N]

3. **Task Context Check** (Tier 3)
   - [ ] Referenced SOPs current: [Y/N]
   - [ ] Dependencies checked: [list]

**Context Status**: ‚úÖ Fresh / ‚ö†Ô∏è Stale (re-reading required)
```

### 4. Implement Quick Check Command

Create a script agents can run:

```bash
#!/bin/bash
# scripts/check-context-freshness.sh

echo "üîç Context Freshness Check"
echo "=========================="

# Check governance files
for file in AGENT_CONTEXT.md CLAUDE.md prompts/agents/AGENT_POLICIES.md; do
    if [ -f "$file" ]; then
        LAST_MOD=$(git log -1 --format="%ar" -- "$file" 2>/dev/null)
        echo "  $file: $LAST_MOD"
    fi
done

# Check for recent priority updates
echo ""
echo "üìã Recent Priority Updates:"
head -30 output/shared/PROJECT_PRIORITIES.md | grep -E "^\|.*P[0-3]"

# Check for recent governance changes
echo ""
echo "üìù Governance Changes (last 6 hours):"
git log --oneline --since="6 hours ago" -- prompts/ docs/sops/ AGENT_CONTEXT.md CLAUDE.md
```

### 5. Define Mindframe Update Triggers

An agent must re-read and update their understanding when:

| Trigger | Action Required |
|---------|-----------------|
| Governance version changed | Full re-read of AGENT_POLICIES.md |
| New SOP added | Read new SOP if relevant to role |
| Priority file shows new P0/P1 | Acknowledge and prioritize |
| Memory file has new session | Review for context/blockers |
| Role file version changed | Re-read entire role file |

### 6. Add to Session Start Sequence

Update the bootstrap/session start to include:

```
### Step 0.5: Context Freshness Check (Before Reading Inbox)

If starting from an inbox prompt:

1. Run freshness check:
   ```bash
   ./scripts/check-context-freshness.sh
   ```

2. Compare versions:
   - My last known AGENT_POLICIES version: ___
   - Current version: ___
   - Needs re-read? [Y/N]

3. If stale (>2 hours or version mismatch):
   ```bash
   cat prompts/agents/AGENT_POLICIES.md | head -50
   ```

4. Acknowledge any changes before proceeding
```

DELIVERABLES:
-------------

1. **Update AGENT_POLICIES.md** with:
   - New "Context Freshness Verification" section
   - File tier classification table
   - Freshness thresholds
   - Pre-work verification checklist

2. **Create scripts/check-context-freshness.sh**
   - Quick command for agents to verify context
   - Shows recent changes to key files
   - Outputs freshness status

3. **Update Session Start sequence**
   - Add Step 0.5 for context check
   - Make it mandatory for inbox-triggered work

4. **Create tracking mechanism**
   - Way for agents to record last-read timestamps
   - Could be in memory file or separate tracker

5. **Update CLAUDE.md and .cursorrules**
   - Add context freshness to bootstrap

FORMAT REQUIREMENTS:
--------------------

- All changes must follow existing governance structure
- Include version updates for modified files
- Add to version history in each file
- Create terminal-friendly script output
- Keep thresholds reasonable (not too aggressive, not too lax)

SUCCESS CRITERIA:
-----------------

‚ñ° Agents always know if their context is current
‚ñ° Stale context is detected and corrected before work begins
‚ñ° Simple command to check freshness status
‚ñ° Clear thresholds defined for each file tier
‚ñ° Minimal overhead - quick checks, not time-consuming
‚ñ° Documented in governance files

IMPLEMENTATION NOTES:
---------------------

Consider these tradeoffs:
- Too frequent checks = overhead and slow starts
- Too infrequent = stale context and errors
- 2-4 hour thresholds balance freshness with efficiency

For "mindframe" tracking, consider:
- Adding "Last Context Sync" timestamp to memory files
- Creating a lightweight .context-state file per agent
- Using git log timestamps as source of truth

HANDOFF:
--------

When complete:
1. Move this file to output/documentation-agent/done/
2. Test the freshness check script
3. Verify the rule is clear and actionable

## Quick Actions (reply with number, or just press Enter to continue):

1. Documentation Agent: Execute this task now ‚Üê DEFAULT
2. Testing Agent: Review and validate the freshness system
3. Read this prompt: `cat output/documentation-agent/inbox/TASK-context-freshness-rule.txt`
4. Check project priorities: `cat output/shared/PROJECT_PRIORITIES.md`
5. No further action needed

**‚è±Ô∏è Auto-continue**: If no response, proceed with Option 1

(DOC Agent)

